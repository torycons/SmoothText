//
//  ViewController.swift
//  SmoothText
//
//  Created by Thanapat Sorralump on 19/3/2567 BE.
//

import UIKit

private let serialQueue = DispatchQueue(label: "com.text.test")

final class ViewController: UIViewController {

  @IBOutlet weak var tableView: UITableView!

  var data: [String] = [
    "1 ðŸ¥² à¸ªà¸²à¸¡à¸Šà¹ˆà¸²à¸œà¹‰à¸²à¸«à¹ˆà¸¡à¸«à¸¡à¸§à¸¢ www.apple.com à¸›à¸±à¸ˆà¹€à¸ˆà¸à¸Šà¸™à¸£à¸²à¸ªà¹€à¸šà¸­à¸£à¹Œà¸£à¸µà¹à¸Ÿà¸£à¸µà¹ˆà¸žà¸‡à¸©à¹Œ à¸ªà¹„à¸¥à¸”à¹Œ à¹€à¸­à¹‹à¸­à¹€à¸›à¸£à¸²à¸°à¸šà¸²à¸‡à¸‹à¸µà¹€à¸£à¸µà¸¢à¸ª à¸™à¸¹à¹‰à¸”à¹à¸­à¹‡à¸„à¸Šà¸±à¹ˆà¸™à¹€à¸„à¸£à¸›à¸•à¸±à¸§à¸•à¸™ à¸œà¹‰à¸²à¸«à¹ˆà¸¡ à¹à¸žà¸¥à¸™à¸™à¸­à¸£à¹Œà¸—à¸œà¸¥à¹„à¸¡à¹‰à¹‚à¸£à¹à¸¡à¸™à¸•à¸´à¸ à¸—à¸±à¸§à¸£à¹Œà¸™à¸²à¹€à¸¡à¸™à¸—à¹Œà¸­à¸±à¸¥à¸šà¸±à¸¡à¹€à¸‰à¸´à¹ˆà¸¡à¸”à¸´à¸ªà¹€à¸„à¸£à¸”à¸´à¸• à¹€à¸—à¸„à¹‚à¸™à¸žà¸±à¸™à¸˜à¸à¸´à¸ˆà¹à¸¥à¸™à¸”à¹Œ à¹€à¸Ÿà¸£à¸Šà¸Šà¸µà¹ˆà¸žà¸£à¸µà¹€à¸‹à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¸™à¸­à¸£à¹Œà¸— à¸ªà¸¶à¸™à¸²à¸¡à¸´ à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¸™à¹‡à¸­à¸„ à¸ˆà¸±à¸‡à¹‚à¸à¹‰ à¹€à¸žà¸£à¸ª à¸•à¸±à¸§à¹€à¸­à¸‡à¸œà¹‰à¸²à¸«à¹ˆà¸¡à¸„à¸¹à¸¥à¹€à¸¥à¸­à¸£à¹Œà¸”à¸µà¹„à¸‹à¸™à¹Œ à¸«à¸¡à¸±à¹ˆà¸™à¹‚à¸–à¸§ à¹€à¸—à¸„à¹‚à¸™à¹à¸„à¸£à¸•à¸ªà¹€à¸›à¸à¹à¸Ÿà¸£à¸™à¹„à¸Šà¸ªà¹Œà¹€à¸§à¸´à¸£à¹Œà¸¥à¸”à¹Œ à¹‚à¸¡à¹€à¸”à¸´à¸£à¹Œà¸™à¸‡à¸µà¹‰ à¹„à¸™à¸™à¹Œ à¹„à¸„à¸¥à¹à¸¡à¸à¸‹à¹Œà¸„à¸²à¹€à¸Ÿà¹ˆà¹€à¸„à¸­à¸£à¹Œà¸Ÿà¸´à¸§ à¸•à¸´à¸§à¸•à¸²à¸›à¸£à¸·à¸­à¸£à¸µà¸ªà¸­à¸£à¹Œà¸—à¹à¸«à¸¡à¹‡à¸šà¹à¸­à¹‡à¸„à¸Šà¸±à¹ˆà¸™ à¹à¸£à¸‡à¸”à¸¹à¸”à¸Šà¸±à¸•à¹€à¸•à¸­à¸£à¹Œà¹€à¸­à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¹€à¸—à¸™ à¸§à¸­à¸Ÿà¹€à¸Ÿà¸´à¸¥à¹€à¸§à¸´à¸£à¹Œà¸¥à¸”à¹Œà¹€à¸—à¸„à¹‚à¸›à¸£à¹€à¸ˆà¹‡à¸„à¸—à¹Œà¹€à¸¥à¸´à¸Ÿ à¸£à¸²à¹€à¸¡à¸™ à¹à¸šà¸™à¹€à¸™à¸­à¸£à¹Œà¸§à¸µà¹€à¸ˆà¹„à¸¡à¹€à¸à¸£à¸™à¹à¸­à¸£à¹Œ à¹à¸­à¹‡à¸à¸Šà¸±à¹ˆà¸™à¸šà¸¸à¹‹à¸™ à¸šà¸£à¸²à¸™à¸¹à¹‰à¸”à¹€à¸­à¸Ÿà¹€à¸Ÿà¹‡à¸à¸•à¹Œà¸•à¸±à¸§à¹€à¸­à¸‡à¸žà¸´à¸‹à¸‹à¹ˆà¸² à¹€à¸­à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¹€à¸—à¸™à¹€à¸šà¸šà¸µà¹‰ à¹à¸Ÿà¸™à¸‹à¸µà¹à¸£à¸‡à¹ƒà¸ˆ à¸§à¸­à¸¥à¸™à¸±à¸—à¸‹à¸¹à¹€à¸­à¸µà¹‹à¸¢à¹à¸¥à¸™à¸”à¹Œà¸­à¸¶à¹‹à¸¡à¹à¸Ÿà¸à¸‹à¹Œ à¸™à¸´à¸™à¸ˆà¸² à¸”à¸µà¸žà¸²à¸£à¹Œà¸•à¹€à¸¡à¸™à¸—à¹Œ à¸ªà¸²à¸¡à¸Šà¹ˆà¸²à¸œà¹‰à¸²à¸«à¹ˆà¸¡à¸«à¸¡à¸§à¸¢ à¸›à¸±à¸ˆà¹€à¸ˆà¸à¸Šà¸™à¸£à¸²à¸ªà¹€à¸šà¸­à¸£à¹Œà¸£à¸µà¹à¸Ÿà¸£à¸µà¹ˆà¸žà¸‡à¸©à¹Œ à¸ªà¹„à¸¥à¸”à¹Œ à¹€à¸­à¹‹à¸­à¹€à¸›à¸£à¸²à¸°à¸šà¸²à¸‡à¸‹à¸µà¹€à¸£à¸µà¸¢à¸ª à¸™à¸¹à¹‰à¸”à¹à¸­à¹‡à¸„à¸Šà¸±à¹ˆà¸™à¹€à¸„à¸£à¸›à¸•à¸±à¸§à¸•à¸™ à¸œà¹‰à¸²à¸«à¹ˆà¸¡ à¹à¸žà¸¥à¸™à¸™à¸­à¸£à¹Œà¸—à¸œà¸¥à¹„à¸¡à¹‰à¹‚à¸£à¹à¸¡à¸™à¸•à¸´à¸ à¸—à¸±à¸§à¸£à¹Œà¸™à¸²à¹€à¸¡à¸™à¸—à¹Œà¸­à¸±à¸¥à¸šà¸±à¸¡à¹€à¸‰à¸´à¹ˆà¸¡à¸”à¸´à¸ªà¹€à¸„à¸£à¸”à¸´à¸• à¹€à¸—à¸„à¹‚à¸™à¸žà¸±à¸™à¸˜à¸à¸´à¸ˆà¹à¸¥à¸™à¸”à¹Œ à¹€à¸Ÿà¸£à¸Šà¸Šà¸µà¹ˆà¸žà¸£à¸µà¹€à¸‹à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¸™à¸­à¸£à¹Œà¸— à¸ªà¸¶à¸™à¸²à¸¡à¸´ à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¸™à¹‡à¸­à¸„ à¸ˆà¸±à¸‡à¹‚à¸à¹‰ à¹€à¸žà¸£à¸ª à¸•à¸±à¸§à¹€à¸­à¸‡à¸œà¹‰à¸²à¸«à¹ˆà¸¡à¸„à¸¹à¸¥à¹€à¸¥à¸­à¸£à¹Œà¸”à¸µà¹„à¸‹à¸™à¹Œ à¸«à¸¡à¸±à¹ˆà¸™à¹‚à¸–à¸§ à¹€à¸—à¸„à¹‚à¸™à¹à¸„à¸£à¸•à¸ªà¹€à¸›à¸à¹à¸Ÿà¸£à¸™à¹„à¸Šà¸ªà¹Œà¹€à¸§à¸´à¸£à¹Œà¸¥à¸”à¹Œ à¹‚à¸¡à¹€à¸”à¸´à¸£à¹Œà¸™à¸‡à¸µà¹‰ à¹„à¸™à¸™à¹Œ à¹„à¸„à¸¥à¹à¸¡à¸à¸‹à¹Œà¸„à¸²à¹€à¸Ÿà¹ˆà¹€à¸„à¸­à¸£à¹Œà¸Ÿà¸´à¸§ à¸•à¸´à¸§à¸•à¸²à¸›à¸£à¸·à¸­à¸£à¸µà¸ªà¸­à¸£à¹Œà¸—à¹à¸«à¸¡à¹‡à¸šà¹à¸­à¹‡à¸„à¸Šà¸±à¹ˆà¸™ à¹à¸£à¸‡à¸”à¸¹à¸”à¸Šà¸±à¸•à¹€à¸•à¸­à¸£à¹Œà¹€à¸­à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¹€à¸—à¸™ à¸§à¸­à¸Ÿà¹€à¸Ÿà¸´à¸¥à¹€à¸§à¸´à¸£à¹Œà¸¥à¸”à¹Œà¹€à¸—à¸„à¹‚à¸›à¸£à¹€à¸ˆà¹‡à¸„à¸—à¹Œà¹€à¸¥à¸´à¸Ÿ à¸£à¸²à¹€à¸¡à¸™ à¹à¸šà¸™à¹€à¸™à¸­à¸£à¹Œà¸§à¸µà¹€à¸ˆà¹„à¸¡à¹€à¸à¸£à¸™à¹à¸­à¸£à¹Œ à¹à¸­à¹‡à¸à¸Šà¸±à¹ˆà¸™à¸šà¸¸à¹‹à¸™ à¸šà¸£à¸²à¸™à¸¹à¹‰à¸”à¹€à¸­à¸Ÿà¹€à¸Ÿà¹‡à¸à¸•à¹Œà¸•à¸±à¸§à¹€à¸­à¸‡à¸žà¸´à¸‹à¸‹à¹ˆà¸² à¹€à¸­à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¹€à¸—à¸™à¹€à¸šà¸šà¸µà¹‰ à¹à¸Ÿà¸™à¸‹à¸µà¹à¸£à¸‡à¹ƒà¸ˆ à¸§à¸­à¸¥à¸™à¸±à¸—à¸‹à¸¹à¹€à¸­à¸µà¹‹à¸¢à¹à¸¥à¸™à¸”à¹Œà¸­à¸¶à¹‹à¸¡à¹à¸Ÿà¸à¸‹à¹Œ à¸™à¸´à¸™à¸ˆà¸² à¸”à¸µà¸žà¸²à¸£à¹Œà¸•à¹€à¸¡à¸™à¸—à¹Œ à¸ªà¸²à¸¡à¸Šà¹ˆà¸²à¸œà¹‰à¸²à¸«à¹ˆà¸¡à¸«à¸¡à¸§à¸¢ à¸›à¸±à¸ˆà¹€à¸ˆà¸à¸Šà¸™à¸£à¸²à¸ªà¹€à¸šà¸­à¸£à¹Œà¸£à¸µà¹à¸Ÿà¸£à¸µà¹ˆà¸žà¸‡à¸©à¹Œ à¸ªà¹„à¸¥à¸”à¹Œ à¹€à¸­à¹‹à¸­à¹€à¸›à¸£à¸²à¸°à¸šà¸²à¸‡à¸‹à¸µà¹€à¸£à¸µà¸¢à¸ª à¸™à¸¹à¹‰à¸”à¹à¸­à¹‡à¸„à¸Šà¸±à¹ˆà¸™à¹€à¸„à¸£à¸›à¸•à¸±à¸§à¸•à¸™ www.google.com à¸œà¹‰à¸²à¸«à¹ˆà¸¡ à¹à¸žà¸¥à¸™à¸™à¸­à¸£à¹Œà¸—à¸œà¸¥à¹„à¸¡à¹‰à¹‚à¸£à¹à¸¡à¸™à¸•à¸´à¸ à¸—à¸±à¸§à¸£à¹Œà¸™à¸²à¹€à¸¡à¸™à¸—à¹Œà¸­à¸±à¸¥à¸šà¸±à¸¡à¹€à¸‰à¸´à¹ˆà¸¡à¸”à¸´à¸ªà¹€à¸„à¸£à¸”à¸´à¸• à¹€à¸—à¸„à¹‚à¸™à¸žà¸±à¸™à¸˜à¸à¸´à¸ˆà¹à¸¥à¸™à¸”à¹Œ à¹€à¸Ÿà¸£à¸Šà¸Šà¸µà¹ˆà¸žà¸£à¸µà¹€à¸‹à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¸™à¸­à¸£à¹Œà¸— à¸ªà¸¶à¸™à¸²à¸¡à¸´ à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¸™à¹‡à¸­à¸„ à¸ˆà¸±à¸‡à¹‚à¸à¹‰ à¹€à¸žà¸£à¸ª à¸•à¸±à¸§à¹€à¸­à¸‡à¸œà¹‰à¸²à¸«à¹ˆà¸¡à¸„à¸¹à¸¥à¹€à¸¥à¸­à¸£à¹Œà¸”à¸µà¹„à¸‹à¸™à¹Œ à¸«à¸¡à¸±à¹ˆà¸™à¹‚à¸–à¸§ à¹€à¸—à¸„à¹‚à¸™à¹à¸„à¸£à¸•à¸ªà¹€à¸›à¸à¹à¸Ÿà¸£à¸™à¹„à¸Šà¸ªà¹Œà¹€à¸§à¸´à¸£à¹Œà¸¥à¸”à¹Œ à¹‚à¸¡à¹€à¸”à¸´à¸£à¹Œà¸™à¸‡à¸µà¹‰ à¹„à¸™à¸™à¹Œ à¹„à¸„à¸¥à¹à¸¡à¸à¸‹à¹Œà¸„à¸²à¹€à¸Ÿà¹ˆà¹€à¸„à¸­à¸£à¹Œà¸Ÿà¸´à¸§ à¸•à¸´à¸§à¸•à¸²à¸›à¸£à¸·à¸­à¸£à¸µà¸ªà¸­à¸£à¹Œà¸—à¹à¸«à¸¡à¹‡à¸šà¹à¸­à¹‡à¸„à¸Šà¸±à¹ˆà¸™ à¹à¸£à¸‡à¸”à¸¹à¸”à¸Šà¸±à¸•à¹€à¸•à¸­à¸£à¹Œà¹€à¸­à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¹€à¸—à¸™ à¸§à¸­à¸Ÿà¹€à¸Ÿà¸´à¸¥à¹€à¸§à¸´à¸£à¹Œà¸¥à¸”à¹Œà¹€à¸—à¸„à¹‚à¸›à¸£à¹€à¸ˆà¹‡à¸„à¸—à¹Œà¹€à¸¥à¸´à¸Ÿ à¸£à¸²à¹€à¸¡à¸™ à¹à¸šà¸™à¹€à¸™à¸­à¸£à¹Œà¸§à¸µà¹€à¸ˆà¹„à¸¡à¹€à¸à¸£à¸™à¹à¸­à¸£à¹Œ à¹à¸­à¹‡à¸à¸Šà¸±à¹ˆà¸™à¸šà¸¸à¹‹à¸™ à¸šà¸£à¸²à¸™à¸¹à¹‰à¸”à¹€à¸­à¸Ÿà¹€à¸Ÿà¹‡à¸à¸•à¹Œà¸•à¸±à¸§à¹€à¸­à¸‡à¸žà¸´à¸‹à¸‹à¹ˆà¸² à¹€à¸­à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¹€à¸—à¸™à¹€à¸šà¸šà¸µà¹‰ à¹à¸Ÿà¸™à¸‹à¸µà¹à¸£à¸‡à¹ƒà¸ˆ à¸§à¸­à¸¥à¸™à¸±à¸—à¸‹à¸¹à¹€à¸­à¸µà¹‹à¸¢à¹à¸¥à¸™à¸”à¹Œà¸­à¸¶à¹‹à¸¡à¹à¸Ÿà¸à¸‹à¹Œ à¸™à¸´à¸™à¸ˆà¸² à¸”à¸µà¸žà¸²à¸£à¹Œà¸•à¹€à¸¡à¸™à¸—à¹Œ",
    "2 ðŸ¥² à¹‚à¸¡à¹€à¸”à¸´à¸£à¹Œà¸™à¸‡à¸µà¹‰ à¹„à¸™à¸™à¹Œ à¹„à¸„à¸¥à¹à¸¡à¸à¸‹à¹Œà¸„à¸²à¹€à¸Ÿà¹ˆà¹€à¸„à¸­à¸£à¹Œà¸Ÿà¸´à¸§ à¸•à¸´à¸§à¸•à¸²à¸›à¸£à¸·à¸­à¸£à¸µà¸ªà¸­à¸£à¹Œà¸—à¹à¸«à¸¡à¹‡à¸šà¹à¸­à¹‡à¸„à¸Šà¸±à¹ˆà¸™ à¹à¸£à¸‡à¸”à¸¹à¸”à¸Šà¸±à¸•à¹€à¸•à¸­à¸£à¹Œà¹€à¸­à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¹€à¸—à¸™ à¸§à¸­à¸Ÿà¹€à¸Ÿà¸´à¸¥à¹€à¸§à¸´à¸£à¹Œà¸¥à¸”à¹Œà¹€à¸—à¸„à¹‚à¸›à¸£à¹€à¸ˆà¹‡à¸„à¸—à¹Œà¹€à¸¥à¸´à¸Ÿ à¸£à¸²à¹€à¸¡à¸™ à¹à¸šà¸™à¹€à¸™à¸­à¸£à¹Œà¸§à¸µà¹€à¸ˆà¹„à¸¡à¹€à¸à¸£à¸™à¹à¸­à¸£à¹Œ à¹à¸­à¹‡à¸à¸Šà¸±à¹ˆà¸™à¸šà¸¸à¹‹à¸™ à¸šà¸£à¸²à¸™à¸¹à¹‰à¸”à¹€à¸­à¸Ÿà¹€à¸Ÿà¹‡à¸à¸•à¹Œà¸•à¸±à¸§à¹€à¸­à¸‡à¸žà¸´à¸‹à¸‹à¹ˆà¸² à¹€à¸­à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¹€à¸—à¸™à¹€à¸šà¸šà¸µà¹‰ à¹à¸Ÿà¸™à¸‹à¸µà¹à¸£à¸‡à¹ƒà¸ˆ à¸§à¸­à¸¥à¸™à¸±à¸—à¸‹à¸¹à¹€à¸­à¸µà¹‹à¸¢à¹à¸¥à¸™à¸”à¹Œà¸­à¸¶à¹‹à¸¡à¹à¸Ÿà¸à¸‹à¹Œ à¸™à¸´à¸™à¸ˆà¸² à¸”à¸µà¸žà¸²à¸£à¹Œà¸•à¹€à¸¡à¸™à¸—à¹Œ à¸ªà¸²à¸¡à¸Šà¹ˆà¸²à¸œà¹‰à¸²à¸«à¹ˆà¸¡à¸«à¸¡à¸§à¸¢ à¸›à¸±à¸ˆà¹€à¸ˆà¸à¸Šà¸™à¸£à¸²à¸ªà¹€à¸šà¸­à¸£à¹Œà¸£à¸µà¹à¸Ÿà¸£à¸µà¹ˆà¸žà¸‡à¸©à¹Œ à¸ªà¹„à¸¥à¸”à¹Œ à¹€à¸­à¹‹à¸­à¹€à¸›à¸£à¸²à¸°à¸šà¸²à¸‡à¸‹à¸µà¹€à¸£à¸µà¸¢à¸ª à¸™à¸¹à¹‰à¸”à¹à¸­à¹‡à¸„à¸Šà¸±à¹ˆà¸™à¹€à¸„à¸£à¸›à¸•à¸±à¸§à¸•à¸™ à¸œà¹‰à¸²à¸«à¹ˆà¸¡ à¹à¸žà¸¥à¸™à¸™à¸­à¸£à¹Œà¸—à¸œà¸¥à¹„à¸¡à¹‰à¹‚à¸£à¹à¸¡à¸™à¸•à¸´à¸ à¸—à¸±à¸§à¸£à¹Œà¸™à¸²à¹€à¸¡à¸™à¸—à¹Œà¸­à¸±à¸¥à¸šà¸±à¸¡à¹€à¸‰à¸´à¹ˆà¸¡à¸”à¸´à¸ªà¹€à¸„à¸£à¸”à¸´à¸• à¹€à¸—à¸„à¹‚à¸™à¸žà¸±à¸™à¸˜à¸à¸´à¸ˆà¹à¸¥à¸™à¸”à¹Œ à¹€à¸Ÿà¸£à¸Šà¸Šà¸µà¹ˆà¸žà¸£à¸µà¹€à¸‹à¹‡à¸™à¹€à¸•à¸­à¸£à¹Œà¸™à¸­à¸£à¹Œà¸— à¸ªà¸¶à¸™à¸²à¸¡à¸´ à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¸™à¹‡à¸­à¸„ à¸ˆà¸±à¸‡à¹‚à¸à¹‰ à¹€à¸žà¸£à¸ª à¸•à¸±à¸§à¹€à¸­à¸‡à¸œà¹‰à¸²à¸«à¹ˆà¸¡à¸„à¸¹à¸¥à¹€à¸¥à¸­à¸£à¹Œà¸”à¸µà¹„à¸‹à¸™à¹Œ à¸«à¸¡à¸±à¹ˆà¸™à¹‚à¸–à¸§ à¹€à¸—à¸„à¹‚à¸™à¹à¸„à¸£à¸•à¸ªà¹€à¸›à¸à¹à¸Ÿà¸£à¸™à¹„à¸Šà¸ªà¹Œà¹€à¸§à¸´à¸£à¹Œà¸¥à¸”à¹Œ à¹‚à¸¡à¹€à¸”à¸´à¸£à¹Œà¸™à¸‡à¸µà¹‰ à¹„à¸™à¸™à¹Œ à¹„à¸„à¸¥à¹à¸¡à¸à¸‹à¹Œà¸„à¸²à¹€à¸Ÿà¹ˆà¹€à¸„à¸­à¸£à¹Œà¸Ÿà¸´à¸§",
    "3 ðŸ¥² à¸«à¸¡à¸±à¹ˆà¸™à¹‚à¸–à¸§ à¹€à¸—à¸„à¹‚à¸™à¹à¸„à¸£à¸•à¸ªà¹€à¸›à¸à¹à¸Ÿà¸£à¸™à¹„à¸Šà¸ªà¹Œà¹€à¸§à¸´à¸£à¹Œà¸¥à¸”à¹Œ à¹‚à¸¡à¹€à¸”à¸´à¸£à¹Œà¸™à¸‡à¸µà¹‰ à¹„à¸™à¸™à¹Œ",
    "4 ðŸ¥² à¸«à¸¡à¸±à¹ˆà¸™à¹‚à¸–à¸§",
    "5 ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²ðŸ¥²"
  ]

  var cells: [NSAttributedString] = []

  override func viewDidLoad() {
    super.viewDidLoad()
    serialQueue.async { [weak self] in
      guard let self else { return }
      for i in 0...10 {
        let data = data[i % data.count]
        cells.append(AsyncUILabel.TextUtility.shared.detectLinkAndUpdateCacheData(
          attributedString: NSAttributedString(string: data, attributes: [.font: UIFont.systemFont(ofSize: 15), .foregroundColor: UIColor.blue]),
          checkingResultType: [.link],
          width: UIScreen.main.bounds.width))
      }
      DispatchQueue.main.async { [weak self] in
        guard let self else { return }
        tableView.reloadData()
      }
    }
    tableView.dataSource = self
    tableView.delegate = self
    tableView.register(
      UINib(
        nibName: String(describing: TextUILabelCell.self),
        bundle: nil),
      forCellReuseIdentifier: String(describing: TextUILabelCell.self)
    )
    tableView.register(
      UINib(
        nibName: String(describing: CoreTextLabel.self),
        bundle: nil),
      forCellReuseIdentifier: String(describing: CoreTextLabel.self)
    )
  }
}

extension ViewController: UITableViewDataSource {
  func numberOfSections(in tableView: UITableView) -> Int {
    1
  }

  func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
    cells.count
  }

  func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
//    if let cell = tableView.dequeueReusableCell(withIdentifier: String(describing: CoreTextLabel.self), for: indexPath) as? CoreTextLabel {
//      cell.configure(data: cells[indexPath.row])
//      cell.delegate = self
//      return cell
//    }

    if let cell = tableView.dequeueReusableCell(withIdentifier: String(describing: TextUILabelCell.self), for: indexPath) as? TextUILabelCell {
//      (cell.lbLabel as? TestUILabelAsync)?.delegate = self
      cell.lbLabel.delegate = self
      cell.configure(text: cells[indexPath.row])
      return cell
    }


    return UITableViewCell()
  }
}

extension ViewController: UITableViewDelegate {
  func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat {
    return UITableView.automaticDimension
  }
}

extension ViewController: CoreTextLabelDelegate {
  func updateTableView() {
    tableView.performBatchUpdates(nil)
  }
}

extension ViewController: TestUILabelAsyncDelegate {
  func update() {
//    UITableView.performWithoutAnimation {
      tableView.performBatchUpdates(nil)
//    }
  }
}

extension ViewController: AsyncUILabelDelegate {
  func asynUILabel(_ label: AsyncUILabel, didTapLinkWith url: URL) {
    print(url)
  }

  func asynUILabel(didTapLabelWith label: AsyncUILabel) {
    print("did tap label")
  }

  func asynUILabel(didUpdateLabelWith label: AsyncUILabel) {
    tableView.performBatchUpdates(nil)
  }
}
